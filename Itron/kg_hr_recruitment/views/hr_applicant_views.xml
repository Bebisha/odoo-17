<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <!-- Inheriting the HR Recruitment tree view for customize  -->
    <record id="hr_applicant_inherit_tree_view_id" model="ir.ui.view">
        <field name="name">KG HR Applicant Tree</field>
        <field name="model">hr.applicant</field>
        <field name="inherit_id" ref="hr_recruitment.crm_case_tree_view_job"/>
        <field name="arch" type="xml">
            <!-- fields to invisible from the tree view   -->
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='stage_id']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='refuse_reason_id']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='priority']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='email_from']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='categ_ids']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='user_id']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='interviewer_ids']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='partner_phone']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='medium_id']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='source_id']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='salary_proposed']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='availability']" position="attributes">
                <attribute name="column_invisible">1</attribute>
            </xpath>
            <!-- fields to add in tree view   -->
            <xpath expr="//field[@name='partner_mobile']" position="after">
                <field name="first_level_total" string='First Level' optional="hide"/>
                <field name="technical_first_level_skill" optional="hide"/>
                <field name="technical_second_level_skill" optional="hide"/>
                <field name="hr_round_skill" optional="hide"/>
                <field name="total_mark" optional="hide"/>
            </xpath>
        </field>
    </record>

    <!-- Inheriting the HR Recruitment form view to add fields and customize the form  -->
    <record id="hr_applicant_inherit_view_id" model="ir.ui.view">
        <field name="name">KG HR Applicant Form</field>
        <field name="model">hr.applicant</field>
        <field name="inherit_id" ref="hr_recruitment.hr_applicant_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='email_cc']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='partner_name']" position="attributes">
                <attribute name="required">1</attribute>
            </xpath>
            <xpath expr="//button[@name='archive_applicant']" position="attributes">
                <attribute name="string">Reject</attribute>
            </xpath>
            <xpath expr="//button[@name='archive_applicant']" position="after">
                <button name="action_send_offer_letter" type="object"
                        string="Send Offer Letter" context="{'send_offer_letter':True}" invisible="not is_proposal"
                        class="btn-primary"/>
                <button name="action_final_offer_letter" context="{'send_offer_letter':True}"
                        invisible="not is_proposal" type="object"
                        string="Final Offer Letter" class="btn-primary"/>
            </xpath>
            <xpath expr="//div[hasclass('oe_title')]/label" position="before">
                <field name="sequence"/>
            </xpath>
            <xpath expr="//field[@name='email_from']" position="after">
                <field name="email_to_cc_ids" force_save="True" widget="many2many_tags"
                       required="is_proposal not in [False, '']"/>
            </xpath>
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="is_proposal" force_save="True" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='department_id']" position="after">
                <field name="pick_offer_letter" force_save="True"/>
            </xpath>
            <xpath expr="//group[@name='recruitment_contract']/label" position="before">
                <field name="applicant_notice_period" force_save="True"/>
                <field name="current_salary" force_save="True"/>
            </xpath>

            <xpath expr="//group[@name='recruitment_contract']/label[@for='salary_proposed']" position="before">
                <field name="percent_for_hike" force_save="True" widget="percentage"/>
            </xpath>
            <notebook position="inside">
                <page string="Feedback">
                    <group>
                        <group string="First level">
                            <label for="communication_skill_mark"/>
                            <div class="o_row">
                                <field name="communication_skill_mark" force_save="True"/>
                                <span>/ 10</span>
                            </div>
                            <label for="attitude_skill_mark"/>
                            <div class="o_row">
                                <field name="attitude_skill_mark" force_save="True"/>
                                <span>/ 10</span>
                            </div>
                            <label for="aptitude_skill_mark"/>
                            <div class="o_row">
                                <field name="aptitude_skill_mark" force_save="True"/>
                                <span>/ 10</span>
                            </div>
                            <label for="commitment_mark"/>
                            <div class="o_row">
                                <field name="commitment_mark" force_save="True"/>
                                <span>/ 10</span>
                            </div>
                            <label for="first_level_total"/>
                            <div class="o_row">
                                <field name="first_level_total" force_save="True"/>
                                <span>/ 10%</span>
                            </div>
                            <label for="first_level_total_in_percent" invisible="1"/>
                            <div class="o_row" invisible="1">
                                <field name="first_level_total_in_percent" force_save="True"/>
                                <span>/ 10%</span>
                            </div>
                        </group>

                        <group string="Technical First level">
                            <label for="technical_first_level_skill"/>
                            <div class="o_row">
                                <field name="technical_first_level_skill" force_save="True"/>
                                <span>/ 10 (20%)</span>
                            </div>

                            <label for="technical_first_level_total" invisible="1"/>
                            <div class="o_row" invisible="1">
                                <field name="technical_first_level_total" force_save="True"/>
                                <span>/ 20%</span>
                            </div>
                        </group>

                        <group string="Technical Second level">
                            <label for="technical_second_level_skill"/>
                            <div class="o_row">
                                <field name="technical_second_level_skill" force_save="True"/>
                                <span>/ 10 (40%)</span>
                            </div>

                            <label for="technical_second_level_total" invisible="1"/>
                            <div class="o_row" invisible="1">
                                <field name="technical_second_level_total" force_save="True"/>
                                <span>/ 40%</span>
                            </div>
                        </group>

                        <group string="HR Round">
                            <label for="hr_round_skill"/>
                            <div class="o_row">
                                <field name="hr_round_skill" force_save="True"/>
                                <span>/ 10 (30%)</span>
                            </div>
                            <label for="hr_round_total" invisible="1"/>
                            <div class="o_row" invisible="1">
                                <field name="hr_round_total" force_save="True"/>
                                <span>/ 30%</span>
                            </div>
                        </group>

                        <group string="Mark Summary">
                            <field name="total_mark" force_save="1"/>
                        </group>
                    </group>

                    <group string="Remark About Applicant">
                        <field name="applicant_remark"/>
                    </group>
                </page>
                <page string="Private Information">
                    <group>
                        <group>
                            <field name="applicant_aadhar_no" force_save="True"/>
                            <field name="country_code" force_save="True" invisible="1"/>
                            <label for="street" string="Address"/>
                            <div class="o_address_format">
                                <field name="street" placeholder="Street..." class="o_address_street"/>
                                <field name="street2" placeholder="Street 2..." class="o_address_street"/>
                                <field name="city" placeholder="City" class="o_address_city"/>
                                <field name="state_id" class="o_address_state" placeholder="State"
                                       options="{'no_open': True, 'no_quick_create': True}"
                                       context="{'default_country_id': country_id}"/>
                                <field name="zip" placeholder="Pin" class="o_address_zip"/>
                                <field name="country_id" placeholder="Country" class="o_address_country"
                                       options='{"no_open": True, "no_create": True}'/>
                            </div>
                            <field name="application_date" force_save="True"/>
                            <field name="total_exp" force_save="True"/>
                            <field name="r_exp" force_save="True"/>
                            <field name="current_designation" force_save="True"/>
                        </group>
                        <group>
                            <field name="applicant_start_date" force_save="True"
                                   required="is_proposal not in [False, '']"/>
                            <field name="applicant_passport_no" force_save="True"/>
                            <field name="amount_in_words" force_save="True" invisible="1"/>

                            <field name="reason_job_change" force_save="True"/>
                            <field name="marital_status" force_save="True"/>
                            <field name="current_location_applicant" force_save="True"/>
                            <field name="source" force_save="True" placeholder="Eg: linkedin"/>
                            <field name="current_company" force_save="True"/>
                        </group>
                    </group>
                </page>
                <page string="Other Info">
                    <group>
                        <group string="Salary Details">
                            <field name="basic_salary" force_save="True"/>
                            <field name="hra" force_save="True"/>
                            <field name="allowances" force_save="True"/>
                            <field name="utility_expenses_allowance" force_save="True"
                                   invisible="country_code == 'IN'"/>
                            <field name="telephone_allowance" force_save="True" invisible="country_code == 'IN'"/>
                            <field name="salary_total" force_save="True"/>
                        </group>
                        <group string="Office Details">
                            <field name="office_email" force_save="True" required="is_proposal not in [False, '']"/>
                            <field name="office_phone" force_save="True" required="is_proposal not in [False, '']"/>
                            <field name="office_location" force_save="True"
                                   invisible="country_code == 'IN'" placeholder="Eg: Dubai Office" required="is_proposal not in [False, '']"/>
                            <field name="reporting_to" force_save="True" required="is_proposal not in [False, '']"/>
                            <field name="offer_letter_date" force_save="True"
                                   required="is_proposal not in [False, '']"/>
                        </group>
                    </group>
                    <group string="Roles and Responsibilities">
                        <field name="roles"/>
                    </group>
                </page>
            </notebook>
        </field>
    </record>

    <!-- hr.applicant custom tree view   -->
    <record model="ir.ui.view" id="hr_application_tree_view_job">
        <field name="name">Custom Applicants</field>
        <field name="model">hr.applicant</field>
        <field name="arch" type="xml">
            <tree string="Applicants" multi_edit="1" sample="1" decoration-danger="application_status == 'refused'"
                  editable="bottom">
                <field name="message_needaction" column_invisible="True"/>
                <field name="last_stage_id" column_invisible="True"/>
                <field name="date_last_stage_update" column_invisible="True"/>
                <field name="name"/>
                <field name="partner_name" optional="show"/>
                <field name="type_id" column_invisible="True"/>
                <field name="job_id" optional="show"/>
                <field name="name" optional="show"/>
                <field name="stage_id" optional="show"/>
                <field name="application_status" optional="show" invisible="application_status == 'ongoing'"/>
                <field name="refuse_reason_id" optional='hide'/>
                <field name="priority" widget="priority" optional="show"/>
                <field name="email_from" optional="hide"/>
                <field name="partner_mobile" widget="phone" optional="show" class="text-end"/>
                <field name="categ_ids" widget="many2many_tags" options="{'color_field': 'color'}" optional="show"/>
                <field name="user_id" widget="many2one_avatar_user" optional="show"/>
                <field name="interviewer_ids" widget="many2many_avatar_user" optional="hide"/>
                <field name="partner_phone" widget="phone" optional="hide"/>
                <field name="medium_id" optional="hide"/>
                <field name="source_id" optional="hide"/>
                <field name="salary_expected" optional="hide"/>
                <field name="salary_proposed" optional="hide"/>
                <field name="availability" optional="hide"/>
                <field name="department_id" readonly="1" column_invisible="context.get('invisible_department', True)"/>
                <field name="company_id" column_invisible="True"/>
                <field name="company_id" groups="base.group_multi_company" readonly="1" optional="hide"/>
            </tree>
        </field>
    </record>

    <!-- Hr Applicant Kanban View -->
    <record model="ir.ui.view" id="hr_kanban_view_applicant_custom_id">
        <field name="name">Hr Applicants Custom kanban</field>
        <field name="model">hr.applicant</field>
        <field name="arch" type="xml">
            <kanban default_group_by="stage_id" class="o_kanban_applicant"
                    quick_create_view="hr_recruitment.quick_create_applicant_form" sample="1">
                <field name="stage_id" options='{"group_by_tooltip": {"requirements": "Requirements"}}'/>
                <field name="date_closed"/>
                <field name="color"/>
                <field name="priority"/>
                <field name="user_id"/>
                <field name="user_email"/>
                <field name="partner_name"/>
                <field name="type_id"/>
                <field name="partner_id"/>
                <field name="job_id"/>
                <field name="department_id"/>
                <field name="attachment_number"/>
                <field name="active"/>
                <field name="activity_ids"/>
                <field name="activity_state"/>
                <field name="refuse_reason_id"/>
                <field name="application_status"/>
                <progressbar field="kanban_state" colors='{"done": "success", "blocked": "danger"}'/>
                <templates>
                    <t t-name="kanban-menu">
                        <a role="menuitem" name="action_makeMeeting" type="object" class="dropdown-item">Schedule
                            Interview
                        </a>
                        <a role="menuitem" name="archive_applicant" type="object" class="dropdown-item">Refuse</a>
                        <a role="menuitem" name="archive_applicant" type="object" class="dropdown-item">Archive</a>
                        <t t-if="widget.deletable">
                            <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
                        </t>
                        <div role="separator" class="dropdown-divider"></div>
                        <ul class="oe_kanban_colorpicker text-center" data-field="color"/>
                    </t>
                    <t t-name="kanban-box">
                        <div t-attf-class="{{!selection_mode ? 'oe_kanban_color_' + kanban_getcolor(record.color.raw_value) : ''}} oe_kanban_card oe_kanban_global_click oe_applicant_kanban oe_semantic_html_override">
                            <field name="date_closed" invisible="1"/>
                            <field name="company_id" invisible="1"/>
                            <div class="ribbon ribbon-top-right" invisible="not date_closed">
                                <span class="text-bg-success">Hired</span>
                            </div>
                            <span class="badge rounded-pill text-bg-danger float-end me-4"
                                  invisible="application_status != 'refused'">Refused
                            </span>
                            <span class="badge rounded-pill text-bg-secondary float-end me-4"
                                  invisible="application_status != 'archived'">Archived
                            </span>
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <b class="o_kanban_record_title mt8" t-if="record.partner_name.raw_value">
                                            <field name="partner_name"/>
                                            <br/>
                                        </b>
                                        <t t-else="1">
                                            <i class="o_kanban_record_title">
                                                <field name="name"/>
                                            </i>
                                            <br/>
                                        </t>
                                        <div class="o_kanban_record_subtitle"
                                             invisible="context.get('search_default_job_id', False)">
                                            <field name="job_id"/>
                                        </div>
                                    </div>
                                </div>
                                <field name="categ_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                                <t t-if="record.partner_mobile.raw_value">
                                    <i class="fa fa-mobile mr4" role="img" aria-label="Mobile" title="Mobile"/>
                                    <field name="partner_mobile" widget="phone"/>
                                    <br/>
                                </t>
                                <field name="applicant_properties" widget="properties"/>
                                <div class="o_kanban_record_bottom mt4">
                                    <div class="oe_kanban_bottom_left">
                                        <div class="float-start mr4" groups="base.group_user">
                                            <field name="priority" widget="priority"/>
                                        </div>
                                        <div class="o_kanban_inline_block mr8">
                                            <field name="activity_ids" widget="kanban_activity"/>
                                        </div>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <a name="action_open_attachments" type="object">
                                            <span title='Documents'>
                                                <i class='fa fa-paperclip' role="img" aria-label="Documents"/>
                                                <t t-esc="record.attachment_number.raw_value"/>
                                            </span>
                                        </a>
                                        <field name="kanban_state" widget="state_selection"/>
                                        <field name="legend_normal" invisible="1"/>
                                        <field name="legend_blocked" invisible="1"/>
                                        <field name="legend_done" invisible="1"/>
                                        <field name="user_id" widget="many2one_avatar_user"/>
                                    </div>

                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!--  Application custom action -->
    <record id="action_hr_applicant_view" model="ir.actions.act_window">
        <field name="name">HR Applications</field>
        <field name="res_model">hr.applicant</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="context">{}</field>
        <field name="view_id" ref="kg_hr_recruitment.hr_application_tree_view_job"/>
    </record>

    <!-- custom menu item for applications  -->
    <menuitem name="All Applications"
              parent="hr_recruitment.menu_crm_case_categ0_act_job"
              id="menu_application_id" action="action_hr_applicant_view"
              groups="kg_hr_recruitment.hr_applicant_custom_hr_id" sequence="2"/>

    <!-- override menu to add group -->
    <menuitem
            name="All Applications"
            parent="hr_recruitment.menu_crm_case_categ0_act_job"
            id="hr_recruitment.menu_crm_case_categ_all_app" action="hr_recruitment.crm_case_categ0_act_job"
            groups="kg_hr_recruitment.hr_applicant_custom_users_id" sequence="2"/>
</odoo>