<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <template id="portal_layout" name="Portal layout: ticket menu entry" inherit_id="portal.portal_breadcrumbs"
              priority="50">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'ticket' or ticket"
                t-attf-class="breadcrumb-item #{'active ' if not ticket else ''}">
                <a t-if="ticket" t-attf-href="/my/tickets?{{ keep_query() }}">Tickets</a>
                <t t-else="">Tickets</t>
            </li>
            <li t-if="ticket" class="breadcrumb-item active">
                <t t-esc="ticket.name"/>
            </li>
        </xpath>
    </template>

    <template id="portal_my_tickets_priority_widget_template" name="Priority Widget Template">
        <span t-attf-class="o_priority_star fa fa-star#{'' if ticket.priority == '1' else '-o'}"/>
    </template>


    <template id="portal_my_home" name="Portal My Home : ticket entries" inherit_id="portal.portal_my_home"
              priority="40">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="title">Tickets</t>
                <t t-set="url" t-value="'/my/tickets'"/>
                <t t-set="placeholder_count" t-value="'ticket_count'"/>
            </t>
            <form method="POST" t-attf-action="/new/ticket">
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            </form>
        </xpath>
    </template>

    <template id="portal_my_tickets" name="My tickets">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>

            <!--                <h3>Tickets-->
            <t t-call="portal.portal_searchbar"/>
            <t t-if="not can_create_ticket">
                <div class="row">
                    <div class="alert alert-danger w-100 text-center">
                        Planned hours
<!--                        <t t-esc="planned_hours"/> -->
                        have been exceeded. You cannot create a support ticket.
                    </div>
                </div>
            </t>
            <div class="row">
                <t t-if="can_create_ticket">
                    <div class="col-2" style="padding:10px;">
                        <form method="POST" t-attf-action="/new/ticket">
                            <button name="create_new_ticket" type="action" class="btn btn-primary"
                                    style="margin-left:10px;margin-bottom:15px;">Create New Ticket
                            </button>
                            <!--                </h3>-->
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                        </form>
                    </div>
                </t>
                <div class="col-2" align="right" style="padding:10px;" valign="center">
                    <form method="GET" t-attf-action="/ticket/planned_hours">
                        <button name="view_planned_hours" type="action" class="btn btn-primary"
                                style="margin-left:10px;margin-bottom:15px;">View Planned Hours
                        </button>
                        <!--                </h3>-->
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                    </form>
                </div>
                <div class="col-2" align="right" style="padding:10px;" valign="center">
                    <form method="GET" t-attf-action="/ticket/contracts">
                        <button name="view_contracts" type="action" class="btn btn-primary"
                                style="margin-left:10px;margin-bottom:15px;">View Contracts
                        </button>
                        <!--                </h3>-->
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                    </form>
                </div>
            </div>

            <t t-if="not tickets">
                <p>There are no tickets in your account.</p>
            </t>
            <t t-if="tickets">
                <t t-call="portal.portal_table">
                    <thead>
                        <th class="text-left">Ref</th>
                        <th class="text-left">Subject</th>
                        <th class="text-left">Category</th>
                        <th class="text-left">Reported On</th>
                        <th class="text-left">Priority</th>
                        <th class="text-left">Status</th>
                    </thead>
                    <tbody>
                        <t t-foreach="tickets" t-as="ticket">
                            <tr>
                                <td class="text-left">
                                    <span t-esc="ticket.number"/>
                                </td>
                                <td class="text-left">
                                    <a t-attf-href="/my/ticket/#{ticket.id}">
                                        <span t-esc="ticket.name"/>
                                    </a>
                                </td>
                                <td class="text-left">
                                    <span t-esc="ticket.category_id.name"/>
                                </td>
                                <td class="text-left">
                                    <span t-esc="ticket.create_date" t-options='{"widget": "datetime"}'/>
                                </td>
                                <td class="text-left">
                                    <t t-call="helpdesk_mgmt.portal_my_tickets_priority_widget_template"/>
                                </td>
                                <td class="text-left">
                                    <span t-esc="ticket.stage_id.name"/>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </t>
            </t>
        </t>
    </template>

    <template id="portal_helpdesk_ticket_page" name="Ticket Portal Template">
        <t t-call="portal.portal_layout">
            <t t-call="portal.portal_record_layout">
                <t t-set="card_header">
                    <div class="row no-gutters">
                        <div class="col-12">
                            <h5 class="d-flex mb-1 mb-md-0 row">
                                <div class="col-9">
                                    <span t-field="ticket.name" class="text-truncate"/>
                                    <small class="text-muted d-none d-md-inline">(#<span t-field="ticket.id"/>)
                                    </small>
                                </div>
                                <div class="col-3 text-right">
                                    <small class="text-right">Stage:</small>
                                    <span t-field="ticket.stage_id.name" class=" badge badge-pill badge-info"
                                          title="Current stage of this task"/>
                                </div>
                            </h5>
                        </div>
                    </div>
                </t>
                <t t-set="card_body">
                    <div class="row mt-3" t-if="ticket.user_id or ticket.partner_id">
                        <div class="col-12 col-md-6 pb-2" t-if="ticket.user_id">
                            <strong>Assigned To</strong>
                            <div class="row">
                                <div class="col d-flex align-items-center flex-grow-0 pr-3">
                                    <img class="rounded-circle mt-1 o_portal_contact_img"
                                         t-att-src="image_data_uri(ticket.user_id.avatar_1024)" alt="Contact"/>
                                </div>
                                <div class="col pl-md-0">
                                    <div t-esc="ticket.user_id" t-options='{"widget": "contact", "fields": ["name"]}'/>
                                    <a t-attf-href="mailto:{{ticket.user_id.email}}" t-if="ticket.user_id.email">
                                        <div t-esc="ticket.user_id"
                                             t-options='{"widget": "contact", "fields": ["email"]}'/>
                                    </a>
                                    <a t-attf-href="tel:{{ticket.user_id.phone}}" t-if="ticket.user_id.phone">
                                        <div t-esc="ticket.user_id"
                                             t-options='{"widget": "contact", "fields": ["phone"]}'/>
                                    </a>
                                </div>
                            </div>
                        </div>


                        <div class="col-12 col-md-6 pb-2" t-if="ticket.partner_id">
                            <strong>Customer</strong>
                            <div class="row">
                                <div class="col d-flex align-items-center flex-grow-0 pr-3">
                                    <img class="rounded-circle mt-1 o_portal_contact_img"
                                         t-att-src="image_data_uri(ticket.partner_id.avatar_1024)" alt="Contact"/>
                                </div>
                                <div class="col pl-md-0">
                                    <div t-field="ticket.partner_id"
                                         t-options='{"widget": "contact", "fields": ["name"]}'/>
                                    <a t-attf-href="mailto:{{ticket.partner_id.email}}" t-if="ticket.partner_id.email">
                                        <div t-field="ticket.partner_id"
                                             t-options='{"widget": "contact", "fields": ["email"]}'/>
                                    </a>
                                    <a t-attf-href="tel:{{ticket.partner_id.phone}}" t-if="ticket.partner_id.phone">
                                        <div t-field="ticket.partner_id"
                                             t-options='{"widget": "contact", "fields": ["phone"]}'/>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-10">
                        <div class="col-12 col-md-6">
                            <div>
                                <strong>Reported On:</strong>
                                <span t-field="ticket.create_date" t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
                            </div>
                            <div>
                                <strong>Deadline:</strong>
                                <span t-field="ticket.closed_date" t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div>
                                <strong>Last Update:</strong>
                                <span t-field="ticket.last_stage_update"
                                      t-options="{&quot;widget&quot;: &quot;date&quot;}"/>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-10">
                        <div class="col-12 col-md-6">
                            <div>
                                <strong>Category:</strong>
                                <span t-field="ticket.category_id.name"/>
                            </div>
                            <div>
                                <strong>Priority:</strong>
                                <t t-call="helpdesk_mgmt.portal_my_tickets_priority_widget_template"/>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div>
                                <strong>Application:</strong>
                                <span t-field="ticket.application_id.name"/>
                            </div>
                        </div>
                    </div>
                    <div class="row" t-if="ticket.description or ticket.attachment_ids">
                        <div t-if="ticket.description"
                             t-attf-class="col-12 col-lg-7 mb-4 mb-md-0 {{'col-lg-7' if ticket.attachment_ids else 'col-lg-12'}}">
                            <hr class="mb-1"/>
                            <div class="d-flex my-2">
                                <strong>Description</strong>
                            </div>
                            <div class="py-1 px-2 bg-100 small" t-field="ticket.description"/>
                        </div>

                    </div>
                    <div t-if="ticket.attachment_ids"
                         t-attf-class="col-12 col-lg-5 o_project_portal_attachments {{'col-lg-5' if ticket.description else 'col-lg-12'}}">
                        <hr class="mb-1 d-none d-lg-block"/>
                        <strong class="d-block mb-2">Attachments</strong>
                        <div class="row">
                            <div t-attf-class="col {{'col-lg-6' if not ticket.description else 'col-lg-12'}}">
                                <ul class="list-group">
                                    <a class="list-group-item list-group-item-action d-flex align-items-center oe_attachments py-1 px-2"
                                       t-foreach='ticket.attachment_ids' t-as='attachment'
                                       t-attf-href="/web/content/#{attachment.id}?download=true&amp;access_token=#{attachment.access_token}"
                                       target="_blank" data-no-post-process="">
                                        <div class='oe_attachment_embedded o_image o_image_small mr-2 mr-lg-3'
                                             t-att-title="attachment.name" t-att-data-mimetype="attachment.mimetype"
                                             t-attf-data-src="/web/image/#{attachment.id}/50x40?access_token=#{attachment.access_token}"/>
                                        <div class='oe_attachment_name text-truncate'>
                                            <t t-esc='attachment.name'/>
                                        </div>
                                    </a>
                                </ul>
                            </div>
                        </div>
                    </div>
                </t>
                <div class="oe_structure mb32"/>
            </t>

            <div class="mt32">
                <h4>
                    <strong>Message and communication history</strong>
                </h4>
                <t t-call="portal.message_thread">
                    <t t-set="object" t-value="ticket"/>
                    <t t-set="token" t-value="ticket.access_token"/>
                    <t t-set="pid" t-value="pid"/>
                    <t t-set="hash" t-value="hash"/>
                </t>
            </div>

        </t>
    </template>

    <template id="portal_create_ticket" name="Create Support Ticket">
        <t t-call="portal.portal_layout">
            <t t-call="portal.portal_record_layout">
                <t t-set="card_header">
                    <div class="text-center py-4 border-bottom">
                        <h3 class="mb-0 fw-bold">Create a Support Ticket</h3>
                        <p class="text-muted">Submit your issue and our support team will assist you.</p>
                    </div>
                </t>
                <t t-set="card_body">
                    <form action="/submitted/ticket" method="POST" class="mt-4 px-3 needs-validation"
                          enctype="multipart/form-data">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                        <div class="row">
                            <!-- Category -->
                            <div class="col-md-4 mb-3">
                                <label for="category" class="fw-bold">
                                    <i class="fa fa-list-alt me-1"></i>
                                    Category
                                </label>
                                <select class="form-select" id="category" name="category"
                                        t-att-data-enhancement-hrs="enhancement_hrs"
                                        t-att-data-enhancement-spent-hrs="enhancement_spent_hrs"
                                        t-att-data-restrict-ticket="restrict_ticket"
                                        t-att-data-has-amc-success-pack="'true' if has_amc_success_pack else 'false'">

                                    <option value="">-- Select Category --</option>
                                    <t t-foreach="categories" t-as="cat">
                                        <option t-att-value="cat.id">
                                            <t t-esc="cat.name"/>
                                        </option>
                                    </t>
                                </select>
                            </div>

                            <!-- Application -->
                            <div class="col-md-4 mb-3">
                                <label for="application" class="fw-bold">
                                    <i class="fa fa-cogs me-1"></i>
                                    Application
                                </label>
                                <select class="form-select" id="application" name="application">
                                    <option value="">-- Select Application --</option>
                                    <t t-foreach="applications" t-as="app">
                                        <option t-att-value="app.id">
                                            <t t-esc="app.name"/>
                                        </option>
                                    </t>
                                </select>
                            </div>


                            <!-- Priority -->
                            <div class="col-md-4 mb-3">
                                <label for="priority" class="fw-bold">
                                    <i class="fa fa-exclamation-circle me-1"></i>
                                    Priority
                                </label>
                                <select name="priority" class="form-select" required="True">
                                    <option value="">-- Select Priority --</option>
                                    <option value="0">Trivial</option>
                                    <option value="1">Low</option>
                                    <option value="2">Medium</option>
                                    <option value="3">High</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <!-- Subject -->
                            <div class="col-md-12 mb-3">
                                <label for="subject" class="fw-bold">
                                    <i class="fa fa-pencil-alt me-1"></i>
                                    Subject
                                </label>
                                <input type="text" class="form-control" name="subject" placeholder="Enter subject"
                                       required="True"/>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label for="description" class="fw-bold">
                                <i class="fa fa-comment-dots me-1"></i>
                                Description
                            </label>
                            <textarea class="form-control" name="description" rows="4"
                                      placeholder="Provide details about the issue" required="True"></textarea>
                        </div>


                        <label class="col-md-3 col-sm-4 control-label" for="attachment">Add Attachments</label>
                        <div class="col-md-7 col-sm-8" id="attachments-container">
                            <div class="file-input-container">
                                <input class="form-control o_website_form_input" name="attachment[]" type="file"
                                       multiple="multiple" style="margin-bottom:10px;"/>
                                <button type="button" class="remove-file-btn btn" style="display:none;">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </div>
                        </div>

                        <button style="margin-left:16px;" class="fa fa-paperclip" type="button"
                                onclick="addFileInput()"></button>

                        <script>
                            function addFileInput() {
                            const container = document.getElementById('attachments-container');
                            const newInputContainer = document.createElement('div');
                            newInputContainer.classList.add('file-input-container');

                            const newInput = document.createElement('input');
                            newInput.classList.add('form-control', 'o_website_form_input');
                            newInput.name = 'attachment[]';
                            newInput.type = 'file';
                            newInput.multiple = 'multiple';

                            const removeButton = document.createElement('button');
                            removeButton.type = 'button';
                            removeButton.classList.add('remove-file-btn', 'btn');
                            removeButton.innerHTML = '<i class="fa fa-trash"></i>';
                            removeButton.onclick = function () {
                            newInputContainer.remove();
                            };

                            newInputContainer.appendChild(newInput);
                            newInputContainer.appendChild(removeButton);
                            container.appendChild(newInputContainer);
                            }

                            // Initialize the remove button for the first input when the page loads
                            document.addEventListener('DOMContentLoaded', function() {
                            const firstRemoveButton = document.querySelector('.file-input-container button');
                            if (firstRemoveButton) {
                            firstRemoveButton.style.display = 'inline-block'; // Show the remove button for the first
                            input
                            firstRemoveButton.onclick = function () {
                            const firstInputContainer = document.querySelector('.file-input-container');
                            firstInputContainer.remove();
                            };
                            }
                            });
                        </script>

                        <style>
                            .file-input-container {
                            margin-left: 16px;
                            width: 95.5%;
                            margin-top:10px;
                            position: relative;
                            }

                            .remove-file-btn {
                            position: absolute;
                            top: 5px;
                            right: 0;
                            background: transparent;
                            border: none;
                            cursor: pointer;
                            }
                        </style>


                        <!-- Submit Button -->
                        <div class="text-center">
                            <button id="submit" type="submit" class="btn btn-primary btn-lg">
                                <i class="fa fa-paper-plane me-1"></i>
                                Submit Ticket
                            </button>

                        </div>
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                            console.log("DOM fully loaded");

                            const submitBtn = document.getElementById("submit");
                            if (!submitBtn) {
                            console.error("Submit button not found!");
                            return;
                            }

                            submitBtn.addEventListener("click", function (e) {
                            const categoryEl = document.getElementById("category");
                            if (!categoryEl) {
                            console.error("Category dropdown not found!");
                            return;
                            }

                            const selectedText = categoryEl.options[categoryEl.selectedIndex].text.trim().toLowerCase();
                            const enhancementHrs = parseFloat(categoryEl.dataset.enhancementHrs || 0);
                            const enhancementSpentHrs = parseFloat(categoryEl.dataset.enhancementSpentHrs || 0);
                            const restrictTicket = categoryEl.dataset.restrictTicket?.toLowerCase() === "true";
                            const hasAmcSuccessPack = categoryEl.dataset.hasAmcSuccessPack === "true";

                            console.log("Selected Category:", selectedText);
                            console.log("Enhancement Hours Allowed:", enhancementHrs);
                            console.log("Enhancement Hours Spent:", enhancementSpentHrs);
                            console.log("restrictTicket:", restrictTicket);
                            console.log("hasAmcSuccessPack:", hasAmcSuccessPack);

                            if (restrictTicket &amp;&amp; !hasAmcSuccessPack &amp;&amp; selectedText === "enhancement"
                            &amp;&amp; enhancementSpentHrs
                            >= enhancementHrs) {
                            e.preventDefault();
                            alert("Enhancement hours exceeded. You cannot submit a ticket under Enhancement category.");
                            console.warn("Submission blocked due to exceeded enhancement hours.");
                            }
                            });
                            });
                        </script>

                    </form>
                </t>
            </t>
        </t>
    </template>

    <template id="portal_amc_hours" name="Planned Hours Overview">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs" t-value="[('My AMC Hours', '/my/amc/hours')]"/>
            <div class="container mt-4">
                <h3 class="mb-3 text-primary fw-bold">Planned Hours</h3>
                <t t-if="tickets_data">
                    <t t-foreach="tickets_data" t-as="data">
                        <div class="card mb-4 shadow-sm">
                            <!--                        <div class="card-header bg-light">-->
                            <!--                            <h5 class="mb-0 fw-bold">Period: <t t-esc="data['amc'].name"/></h5>-->
                            <!--                        </div>-->
                            <div class="card shadow-sm border-0 bg-light p-4 mb-4">
                                <!-- Contract Period Header -->
                                <h5 class="text-primary mb-3">Contract Period:
                                    <span class="fw-normal text-dark">
                                        <t t-esc="data['amc'].date_start.strftime('%d %B %Y')"/>
                                        -
                                        <t t-esc="data['amc'].date_end.strftime('%d %B %Y')"/>
                                    </span>
                                </h5>

                                <!-- 2-Column Hours Layout -->
                                <div class="row">
                                    <!-- Planned Hours -->
                                    <div class="col-md-6">
                                        <p>
                                            <strong>Total Planned Hours:</strong>
                                            <span class="text-success">
                                                <t t-esc="data['planned_hours']"/>
                                            </span>
                                        </p>
                                        <p>
                                            <strong>Support Hours:</strong>
                                            <span class="text-success">
                                                <t t-esc="data['support_hours']"/>
                                            </span>
                                        </p>
                                        <p>
                                            <strong>Enhancement Hours:</strong>
                                            <span class="text-success">
                                                <t t-esc="data['enhancement_hrs']"/>
                                            </span>
                                        </p>
                                    </div>

                                    <!-- Spent Hours -->
                                    <div class="col-md-6">
                                        <p>
                                            <strong>Total Spent Hours:</strong>
                                            <span t-attf-class="fw-bold #{data['spent_hours'] > data['planned_hours'] and 'text-danger' or 'text-dark'}">
                                                <t t-esc="data['spent_hours']"/>
                                            </span>
                                        </p>
                                        <p>
                                            <strong>Support Spent Hours:</strong>
                                            <span t-attf-class="fw-bold #{data['support_spent_hours'] > data['support_hours'] and 'text-danger' or 'text-dark'}">
                                                <t t-esc="data['support_spent_hours']"/>
                                            </span>
                                        </p>
                                        <p>
                                            <strong>Enhancement Spent Hours:</strong>
                                            <span t-attf-class="fw-bold #{data['enhancement_spent_hours'] > data['enhancement_hrs'] and 'text-danger' or 'text-dark'}">
                                                <t t-esc="data['enhancement_spent_hours']"/>
                                            </span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </t>
            </div>
            <t t-if="data['periods']">
                <t t-foreach="data['periods']" t-as="period">
                    <t t-if="period['start'] and period['end']">
                        <div t-attf-class="border p-3 mb-2 rounded"
                             t-att-style="'background-color: #30495d; color: white;' if period['is_current'] else ''">
                            <p class="fw-bold mb-1">
                                Period
                                <t t-esc="period['index']"/>
                                <t t-if="period['is_current']">
                                    <span class="badge bg-dark ms-2">Current Period</span>
                                </t>
                            </p>
                            <p class="mb-1">
                                <strong>Period:</strong>
                                <t t-if="period['start']">
                                    <t t-esc="period['start'].strftime('%d %B %Y')"/>
                                </t>
                                -
                                <t t-if="period['end']">
                                    <t t-esc="period['end'].strftime('%d %B %Y')"/>
                                </t>
                            </p>
                            <p class="mb-0">
                                <strong>Spent Hours:</strong>
                                <t t-esc="period['spent_hours']"/>
                            </p>
                        </div>
                    </t>
                </t>
            </t>
        </t>
    </template>
    <template id="portal_contracts_view" name="AMC and Free Support Contracts">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs" t-value="[('My Contracts', '/ticket/contracts')]"/>
            <div class="container mt-4">
                <t t-if="amc_data">
                    <h3 class="mb-4 fw-bold">AMC</h3>
                    <t t-foreach="amc_data" t-as="data">
                        <div t-attf-class="card mb-3 p-3 shadow-sm {{ 'border-success border-3' if data['is_current'] else '' }}">
                            <h5 class="fw-bold mb-2">
                                <t t-esc="data['record'].name"/>
                                <t t-if="data['is_current']">
                                    <span class="badge bg-success ms-2">Active</span>
                                </t>
                            </h5>
                            <p>
                                <strong>Contract Period:</strong>
                                <span t-esc="data['record'].date_start.strftime('%d %B %Y')"/>
                                -
                                <span t-esc="data['record'].date_end.strftime('%d %B %Y')"/>
                            </p>
                            <p>
                                <strong>Planned Hours:</strong>
                                <t t-set="hours" t-value="int(data['record'].planned_hrs)"/>
                                <t t-set="minutes" t-value="int(round((data['record'].planned_hrs - hours) * 60))"/>
                                <span t-esc="'%02d:%02d' % (hours, minutes)"/>
                            </p>
                            <p>
                                <strong>Spent Hours:</strong>
                                <t t-set="hours" t-value="int(data['record'].spent_hrs)"/>
                                <t t-set="minutes" t-value="int(round((data['record'].spent_hrs - hours) * 60))"/>
                                <span t-esc="'%02d:%02d' % (hours, minutes)"/>
                            </p>
                        </div>
                    </t>
                </t>

                <hr class="my-5"/>
                <t t-if="free_support_data">
                    <h3 class="mb-4 fw-bold">Free Supports</h3>

                    <t t-foreach="free_support_data" t-as="data">
                        <div t-attf-class="card mb-3 p-3 shadow-sm {{ 'border-warning border-3' if data['is_current'] else '' }}">
                            <h5 class="fw-bold mb-2">
                                <t t-esc="data['record'].name"/>
                                <t t-if="data['is_current']">
                                    <span class="badge bg-success ms-2">Active</span>
                                </t>
                            </h5>
                            <p>
                                <strong>Contract Period:</strong>
                                <t t-esc="data['record'].date_start.strftime('%d %B %Y')"/>
                                -
                                <t t-esc="data['record'].date_end.strftime('%d %B %Y')"/>
                            </p>
                            <p>
                                <strong>Planned Days:</strong>
                                <t t-esc="data['record'].planned_days"/>
                            </p>
                        </div>
                    </t>
                </t>
                <t t-if="success_pack_data">
                    <h3 class="mb-4 fw-bold">Success Packs</h3>

                    <t t-foreach="success_pack_data" t-as="data">
                        <div t-attf-class="card mb-3 p-3 shadow-sm {{ 'border-info border-3' if data['is_current'] else '' }}">
                            <h5 class="fw-bold mb-2">
                                <t t-esc="data['record'].name"/>
                                <t t-if="data['is_current']">
                                    <span class="badge bg-success ms-2">Active</span>
                                </t>
                                <t t-else="">
                                    <span class="badge bg-danger ms-2">Inactive</span>
                                </t>
                            </h5>
                            <p>
                                <strong>Period:</strong>
                                <t t-esc="data['record'].start_date.strftime('%d %B %Y')"/>
                                -
                                <t t-esc="data['record'].end_date.strftime('%d %B %Y')"/>
                            </p>
                            <p>
                                <strong>Planned Hours:</strong>
                                <t t-set="hours" t-value="int(data['record'].estimated_hours)"/>
                                <t t-set="minutes" t-value="int(round((data['record'].estimated_hours - hours) * 60))"/>
                                <span t-esc="'%02d:%02d' % (hours, minutes)"/>
                            </p>
                            <p>
                                <strong>Worked Hours:</strong>
                                <t t-set="hours" t-value="int(data['record'].worked_hours)"/>
                                <t t-set="minutes" t-value="int(round((data['record'].worked_hours - hours) * 60))"/>
                                <span t-esc="'%02d:%02d' % (hours, minutes)"/>
                            </p>
                            <p>
                                <strong>Remaining Hours:</strong>
                                <t t-set="hours" t-value="int(data['record'].remaining_hours)"/>
                                <t t-set="minutes" t-value="int(round((data['record'].remaining_hours - hours) * 60))"/>
                                <span t-esc="'%02d:%02d' % (hours, minutes)"/>
                            </p>
                        </div>
                    </t>
                </t>
            </div>
        </t>
    </template>

</odoo>
