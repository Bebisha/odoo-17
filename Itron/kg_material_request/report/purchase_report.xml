<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_purchaseorder_document_inherit" inherit_id="purchase.report_purchasequotation_document">
        <xpath expr="//th[@name='th_description']" position="before">
            <th>Part Code</th>
        </xpath>
        <xpath expr="//td[1]" position="before">
            <td name="partcode">
                <span t-field="order_line.product_id.default_code"/>
            </td>
        </xpath>
        <xpath expr="//th[@name='th_expected_date']" position="replace">
        </xpath>
        <xpath expr="//td[span[@t-field='order_line.date_planned']]" position="replace">
        </xpath>
        <xpath expr="//t[@t-foreach='o.order_line']//span[@t-field='order_line.product_uom']" position="replace">
        </xpath>

    </template>


    <template id="report_purchaseorder_document_date_inherit" inherit_id="purchase.report_purchaseorder_document">
        <xpath expr="//p[@t-field='o.date_approve']" position="attributes">
            <attribute name="t-options">{"widget": "date"}</attribute>
        </xpath>

        <xpath expr="//th[@name='th_description']" position="before">
            <th>Part Code</th>
        </xpath>
        <xpath expr="//td[1]" position="before">
            <td name="partcode">
                <span t-field="line.product_id.default_code"/>
            </td>
        </xpath>
        <xpath expr="//th[@name='th_date_req']" position="replace">
        </xpath>
        <xpath expr="//td[span[@t-field='line.date_planned']]" position="replace">
        </xpath>

        <!-- Modify the Order Deadline field to show only date without time -->
        <!--        <xpath expr="//p[@t-field='o.date_order']" position="attributes">-->
        <!--            <attribute name="t-options">{"widget": "date"}</attribute>-->
        <!--        </xpath>-->
    </template>


    <!--    <template id="report_delivery_document_enhanced" inherit_id="stock.report_delivery_document">-->

    <!--        <xpath expr="//h2/span[@t-field='o.name']" position="before">-->
    <!--            <div style="text-align: center; margin-bottom: 20px;">-->
    <!--                <h2>DELIVERY SLIPpppppppp</h2>-->
    <!--            </div>-->
    <!--        </xpath>-->
    <!--        <xpath expr="//p[@t-field='o.scheduled_date']" position="attributes">-->
    <!--            <attribute name="t-options">{"widget": "date"}</attribute>-->
    <!--        </xpath>-->
    <!--        <xpath expr="//th[@name='th_sm_product']" position="before">-->
    <!--            <th>Part Code</th>-->
    <!--        </xpath>-->
    <!--        <xpath expr="//table[@name='stock_move_table']//tbody/tr/td[1]" position="before">-->
    <!--            <td>-->
    <!--                <span t-field="move.default_code"/>-->
    <!--            </td>-->
    <!--        </xpath>-->
    <!--    </template>-->

<template id="report_delivery_document_enhanced" inherit_id="stock.report_delivery_document">
    <xpath expr="//h2" position="before">
        <div style="text-align: right; margin-bottom: 20px;">
            <div name="div_outgoing_address" style="text-align: right;">
                <div name="outgoing_delivery_address"
                     t-if="o.should_print_delivery_address()">
                    <span><strong>Delivery Address:</strong></span><br/>
                    <t t-set="delivery_partner" t-value="o.move_ids[0].partner_id or o.partner_id"/>
                    <div style="text-align: right; line-height: 1.4;">
                        <div t-if="delivery_partner.name" style="text-align: right;">
                            <span t-field="delivery_partner.name"/>
                        </div>
                        <div t-if="delivery_partner.street" style="text-align: right;">
                            <span t-field="delivery_partner.street"/>
                        </div>
                        <div t-if="delivery_partner.street2" style="text-align: right;">
                            <span t-field="delivery_partner.street2"/>
                        </div>
                        <div style="text-align: right;">
                            <span t-if="delivery_partner.city" t-field="delivery_partner.city"/>
                            <span t-if="delivery_partner.state_id"> <span t-field="delivery_partner.state_id.name"/></span>
                            <span t-if="delivery_partner.zip"> <span t-field="delivery_partner.zip"/></span>
                        </div>
                        <div t-if="delivery_partner.country_id" style="text-align: right;">
                            <span t-field="delivery_partner.country_id.name"/>
                        </div>
                        <div t-if="delivery_partner.phone" style="text-align: right;">
                            <i class="fa fa-phone"/> <span t-field="delivery_partner.phone"/>
                        </div>
                        <div t-if="delivery_partner.mobile" style="text-align: right;">
                            <i class="fa fa-mobile"/> <span t-field="delivery_partner.mobile"/>
                        </div>
                    </div>
                </div>
                <div name="outgoing_warehouse_address"
                     t-elif="o.picking_type_id.code != 'internal' and o.picking_type_id.warehouse_id.partner_id">
                    <span><strong>Warehouse Address:</strong></span><br/>
                    <t t-set="warehouse_partner" t-value="o.picking_type_id.warehouse_id.partner_id"/>
                    <div style="text-align: right; line-height: 1.4;">
                        <div t-if="warehouse_partner.name" style="text-align: right;">
                            <span t-field="warehouse_partner.name"/>
                        </div>
                        <div t-if="warehouse_partner.street" style="text-align: right;">
                            <span t-field="warehouse_partner.street"/>
                        </div>
                        <div t-if="warehouse_partner.street2" style="text-align: right;">
                            <span t-field="warehouse_partner.street2"/>
                        </div>
                        <div style="text-align: right;">
                            <span t-if="warehouse_partner.city" t-field="warehouse_partner.city"/>
                            <span t-if="warehouse_partner.state_id"> <span t-field="warehouse_partner.state_id.name"/></span>
                            <span t-if="warehouse_partner.zip"> <span t-field="warehouse_partner.zip"/></span>
                        </div>
                        <div t-if="warehouse_partner.country_id" style="text-align: right;">
                            <span t-field="warehouse_partner.country_id.name"/>
                        </div>
                        <div t-if="warehouse_partner.phone" style="text-align: right;">
                            <i class="fa fa-phone"/> <span t-field="warehouse_partner.phone"/>
                        </div>
                        <div t-if="warehouse_partner.mobile" style="text-align: right;">
                            <i class="fa fa-mobile"/> <span t-field="warehouse_partner.mobile"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </xpath>

    <xpath expr="//t[@t-set='address']" position="replace">
        <!-- Empty replacement to remove original address block -->
    </xpath>

    <xpath expr="//h2/span[@t-field='o.name']" position="before">
        <div style="text-align: center; margin-bottom: 20px;">
            <h2>DELIVERY SLIP</h2>
        </div>
    </xpath>

    <xpath expr="//p[@t-field='o.scheduled_date']" position="attributes">
        <attribute name="t-options">{"widget": "date"}</attribute>
    </xpath>
    <xpath expr="//p[@t-field='o.date_done']" position="attributes">
        <attribute name="t-options">{"widget": "date"}</attribute>
    </xpath>

    <xpath expr="//table[@name='stock_move_table']//th[@name='th_sm_product']" position="before">
        <th name="th_part_code">
            <strong>Part Code</strong>
        </th>
    </xpath>

    <xpath expr="//table[@name='stock_move_line_table']//th[@name='th_sml_product']" position="before">
        <th name="th_sml_part_code">
            <strong>Part Code</strong>
        </th>
    </xpath>

    <xpath expr="//table[@name='stock_move_table']//tbody/tr/td[1]" position="before">
        <td>
            <span t-field="move.product_id.default_code"/>
        </td>
    </xpath>

</template>
    <!-- Override the move line template to include part code -->
    <template id="stock_report_delivery_has_serial_move_line" inherit_id="stock.stock_report_delivery_has_serial_move_line" priority="20">
        <xpath expr="//td[span[@t-field='move_line.product_id']]" position="before">
            <td>
                <span t-field="move_line.product_id.default_code" t-options="{'widget': 'text'}"/>
            </td>
        </xpath>
    </template>

    <!-- Override the aggregated move lines template to include part code -->
    <template id="stock_report_delivery_aggregated_move_lines" inherit_id="stock.stock_report_delivery_aggregated_move_lines">
        <xpath expr="//td[1]" position="before">
            <td>
                <span t-field="aggregated_lines[line]['product'].default_code" t-options="{'widget': 'text'}"/>
            </td>
        </xpath>
    </template>

    <template id="custom_remove_uom" inherit_id="purchase.report_purchaseorder_document">
        <xpath expr="//span[@t-field='line.product_uom.name']" position="replace">
        </xpath>
    </template>
</odoo>
