<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="kg_project_task_success_pack_view_tree_inherit" model="ir.ui.view">
        <field name="name">kg.project.task.success.pack.inherit</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="is_success_pack" invisible="1"/>
                <field name="pack_project_id" invisible="is_success_pack != True" required="is_success_pack == True"/>
                <field name="partner_id" invisible="is_success_pack != True" required="is_success_pack == True"/>
                <field name="success_pack_id" invisible="is_success_pack != True" readonly="is_success_pack == True" required="is_success_pack == True"/>
            </xpath>
            <xpath expr="//field[@name='project_id']" position="attributes">
                <attribute name="readonly">is_success_pack == True</attribute>
            </xpath>
        </field>
    </record>
    <record id="success_pack_task_tree" model="ir.ui.view">
        <field name="name">kg.project.task.success.pack.tree</field>
        <field name="model">project.task</field>
        <field name="arch" type="xml">
            <tree string="Tasks">
                <field name="name"/>
                <field name="pack_project_id"/>
                <field name="partner_id"/>
                <field name="user_ids" widget="many2many_tags"/>
                <field name="date_start"/>
                <field name="date_deadline"/>
                <field name="allocated_hours" widget="float_time"/>
                <field name="state"/>
            </tree>
        </field>
    </record>
    <record id="success_pack_task_form" model="ir.ui.view">
        <field name="name">kg.project.task.success.pack.form</field>
        <field name="model">project.task</field>
        <field name="arch" type="xml">

            <form string="Task" class="o_form_project_tasks" js_class="project_task_form" create="1">
                <field name="recurrence_id" invisible="1"/>
                <field name="allow_task_dependencies" invisible="1"/>
                <field name="rating_last_value" invisible="1"/>
                <field name="rating_count" invisible="1"/>
                <field name="allow_milestones" invisible="1"/>
                <field name="parent_id" invisible="1"/>
                <field name="company_id" invisible="1"/>
                <field name="project_id" invisible="1"/>
                <header>
                    <field name="stage_id" widget="statusbar_duration"
                           options="{'clickable': '1'}"
                           />
                    <field name="state" widget="statusbar" options="{'clickable': '1', 'fold_field': 'fold'}"
                           invisible="0"/>
                    <field name="personal_stage_type_id" widget="statusbar"
                           options="{'clickable': '1', 'fold_field': 'fold'}" invisible="project_id"
                           domain="[('user_id', '=', uid)]" string="Personal Stage"/>
                </header>
                <sheet string="Task">

                    <div class="oe_title pe-0">
                        <h1 class="d-flex justify-content-between align-items-center">
                            <div class="d-flex w-100">
                                <field name="priority" widget="priority_switch" class="me-3"/>
                                <field name="name" options="{'line_breaks': False}" widget="text"
                                       class="o_task_name text-truncate w-md-75 w-100 pe-2"
                                       placeholder="Task Title..."/>
                            </div>
                            <div class="d-flex justify-content-end o_state_container" invisible="not active">
                                <field name="state" widget="project_task_state_selection" class="o_task_state_widget"/>
                            </div>
                            <div class="d-flex justify-content-start o_state_container w-100 w-md-50 w-lg-25"
                                 invisible="active">
                                <field name="state" widget="project_task_state_selection" class="o_task_state_widget"/>
                            </div>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="display_in_project" invisible="1" force_save="1"/>
                            <field name="project_id"
                                   domain="[('active', '=', True), '|', ('company_id', '=', False), ('company_id', '=?', company_id)]"
                                   widget="project" invisible="1"
                            />
                            <field name="is_success_pack" invisible="1"/>
                            <field name="pack_project_id"
                                   required="is_success_pack == True" readonly="is_success_pack == True"/>
                            <field name="success_pack_id"
                                   required="is_success_pack == True" readonly="is_success_pack == True" force_save="1"/>
                            <field name="milestone_ids"/>
                            <field name="user_ids"
                                   class="o_task_user_field"
                                   options="{'no_open': True, 'no_quick_create': True}"
                                   widget="many2many_avatar_user"
                                   domain="[('share', '=', False), ('active', '=', True)]"/>
                            <field name="tag_ids" widget="many2many_tags"
                                   options="{'color_field': 'color', 'no_create_edit': True}"
                                   context="{'project_id': project_id}"/>
                        </group>
                        <group>
                            <field name="active" invisible="1"/>
                            <field name="partner_id" nolabel="0" widget="res_partner_many2one"
                                   readonly="is_success_pack == True"
                                   class="o_task_customer_field" invisible="not project_id"/>
                            <field name="task_type"/>
                            <field name="criticality"/>
                            <field name="date_start"/>
                            <field name="allocated_hours" widget="float_time"/>
                            <label for="date_deadline"/>
                            <div id="date_deadline_and_recurring_task" class="d-inline-flex w-100">
                                <field name="date_deadline" nolabel="1"
                                       decoration-danger="date_deadline &lt; current_date and state not in ['1_done', '1_canceled']"/>
                            </div>

                        </group>
                    </group>
                    <notebook>
                        <page string="Timesheets" name="page_timesheets" id="timesheets_tab"
                               groups="hr_timesheet.group_hr_timesheet_user">

                            <field name="timesheet_ids" mode="tree"
                                   context="{'default_project_id': project_id, 'default_name':''}">
                                <tree editable="bottom" string="Timesheet Activities" default_order="date"
                                      decoration-muted="readonly_timesheet == True">
                                    <field name="readonly_timesheet" column_invisible="True"/>
                                    <field name="date" readonly="readonly_timesheet"/>
                                    <field name="project_activity" required="1"/>
                                    <field name="user_id" column_invisible="True"/>
                                    <field name="employee_id" widget="many2one_avatar_employee"
                                           context="{'active_test': True}"
                                           required="1"
                                           readonly="readonly_timesheet"/>
                                    <field name="name" required="0" readonly="readonly_timesheet"/>
                                    <field name="date_start"/>
                                    <field name="date_end"/>
                                    <field name="unit_amount" widget="timesheet_uom"
                                           decoration-danger="unit_amount &gt; 24 or unit_amount &lt; 0"
                                           readonly="readonly_timesheet"/>
                                    <field name="project_id" column_invisible="True"/>
                                    <field name="task_id" column_invisible="True"/>
                                    <field name="company_id" column_invisible="True"/>
                                </tree>
                                <form string="Timesheet Activities">
                                    <sheet>
                                        <group>
                                            <field name="readonly_timesheet" invisible="1"/>
                                            <field name="date" readonly="readonly_timesheet"/>
                                            <field name="user_id" invisible="1" readonly="readonly_timesheet"/>
                                            <field name="employee_id" widget="many2one_avatar_employee"
                                                   context="{'active_test': True}" required="1"
                                                   readonly="readonly_timesheet"/>
                                            <field name="name" required="0" readonly="readonly_timesheet"/>
                                            <field name="unit_amount" string="Duration" widget="float_time"
                                                   decoration-danger="unit_amount &gt; 24"
                                                   readonly="readonly_timesheet"/>
                                            <field name="project_id" invisible="1"/>
                                            <field name="task_id" invisible="1"/>
                                            <field name="company_id" invisible="1"/>
                                        </group>
                                    </sheet>
                                </form>
                            </field>
                            <group>
                                <group class="oe_subtotal_footer" name="project_hours">
                                    <span class="o_td_label float-start">
                                        <label class="fw-bold" for="effective_hours" string="Hours Spent"
                                               />
<!--                                        <label class="fw-bold" for="effective_hours" string="Days Spent"-->
<!--                                               />-->
                                    </span>
                                    <field name="effective_hours" widget="timesheet_uom" nolabel="1"/>
<!--                                    <button name="action_view_subtask_timesheet" type="object"-->
<!--                                            class="ps-0 border-0 oe_inline oe_link mb-2 o_td_label float-start"-->
<!--                                            invisible="subtask_effective_hours == 0.0">-->
<!--                                        <span class="text-nowrap">Hours Spent on-->
<!--                                            Sub-tasks:-->
<!--                                        </span>-->
<!--                                        <span class="text-nowrap" >Days Spent on-->
<!--                                            Sub-tasks:-->
<!--                                        </span>-->
<!--                                    </button>-->
                                    <field name="subtask_effective_hours" class="mt-2" widget="timesheet_uom"
                                           invisible="subtask_effective_hours == 0.0" nolabel="1"/>
<!--                                    <span invisible="subtask_effective_hours == 0.0"-->
<!--                                          class="o_td_label float-start my-1">-->
<!--                                        <label class="fw-bold" for="total_hours_spent" string="Total Hours"-->
<!--                                               invisible="subtask_effective_hours == 0.0 or encode_uom_in_days"/>-->
<!--                                        <label class="fw-bold" for="total_hours_spent" string="Total Days"-->
<!--                                               invisible="subtask_effective_hours == 0.0 or not encode_uom_in_days"/>-->
<!--                                    </span>-->
                                    <field name="total_hours_spent" widget="timesheet_uom"
                                           class="oe_subtotal_footer_separator" nolabel="1"
                                           invisible="subtask_effective_hours == 0.0"/>
<!--                                    <span class="o_td_label float-start my-1" invisible="allocated_hours == 0.0">-->
<!--                                        <label class="fw-bold" for="remaining_hours" string="Remaining Hours"-->
<!--                                               invisible="remaining_hours &lt; 0"/>-->
<!--                                        <label class="fw-bold" for="remaining_hours" string="Remaining Days"-->
<!--                                               invisible="remaining_hours &lt; 0"/>-->
<!--                                        <label class="fw-bold text-danger" for="remaining_hours"-->
<!--                                               string="Remaining Hours"-->
<!--                                               invisible="remaining_hours &gt;= 0"/>-->
<!--                                        <label class="fw-bold text-danger" for="remaining_hours" string="Remaining Days"-->
<!--                                               invisible="remaining_hours &gt;= 0"/>-->
<!--                                    </span>-->
<!--                                    <field name="remaining_hours" widget="timesheet_uom"-->
<!--                                           class="oe_subtotal_footer_separator"-->
<!--                                           invisible="allocated_hours == 0.0" nolabel="1"-->
<!--                                           decoration-danger="remaining_hours &lt; 0"/>-->
                                </group>
                            </group>
                        </page>

                    </notebook>

                </sheet>
            </form>

        </field>
    </record>
</odoo>