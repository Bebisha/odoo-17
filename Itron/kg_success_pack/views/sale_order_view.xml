<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="add_success_pack_in_sale_order" model="ir.ui.view">
            <field name="name">Sale Order Success Pack</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                 <xpath expr="//div[@name='button_box']" position="inside">
                    <button name="action_show_project_pack" type="object" string="Pack Projects" class="oe_stat_button"
                            icon="fa-book" invisible="pack_project_id == False">
                    </button>
                </xpath>

                <xpath expr="//button[@name='action_cancel']" position="after">
                    <button name="create_project_button" string="Create Success Pack" class="btn-primary" type="object"
                            invisible="not (is_fully_paid or amount_total == 0.0 ) or pack_project_id != False or state  in ('draft', 'cancel')"/>

                </xpath>
                <xpath expr="//field[@name='payment_term_id']" position="after">
                    <field name="success_pack" widget="boolean_toggle"/>
                    <field name="kg_partner_id" invisible="1"/>
                     <field name="amount_total" invisible="1"/>
                    <field name="is_fully_paid" widget="boolean_toggle" invisible="1"/>
                    <field name="success_pack_id" invisible="success_pack == False" readonly="state == 'sale'" required="success_pack == True"/>

                    <field name="invoice_status" invisible="1"/>
                </xpath>

                <xpath expr="//field[@name='order_line']/tree//field[@name='name']" position="after">
                    <field name="success_line" force_save="1" column_invisible="1" />
                </xpath>
                <xpath expr="//field[@name='order_line']/tree//field[@name='product_template_id']" position="attributes">
                    <attribute name="readonly">success_line == True</attribute>
                </xpath>
                <xpath expr="//field[@name='project_id']" position="after">
                    <field name="pack_project_id" invisible="1" />
                </xpath>
                <xpath expr="//field[@name='project_id']" position="attributes">
                    <attribute name="invisible">success_pack != False</attribute>
                </xpath>


                <xpath expr="/form/sheet/notebook" position="inside">
                    <page name="success_pack_page" string="Success Pack" invisible="success_pack != True">
                        <group>
                            <group string="Pack Details">
                                <field name="estimated_hours"/>
                            </group>
                            <group string="Project Details">
                                <field name="pm_id"/>
                                <field name="start_date"/>
                                <field name="end_date"/>

                            </group>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>
        <record id="kg_success_pack_order_view_tree" model="ir.ui.view">
            <field name="name">sale.order.view.form.tree</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <tree string="Sale Orders">
                    <field name="name"/>
                    <field name="success_pack_id"/>
                    <field name="partner_id"/>
                    <field name="pm_id"/>
                    <field name="estimated_hours" widget="float_time"/>
                    <field name="worked_hours" widget="float_time"/>

                    <field name="remaining_hours" widget="float_time"/>
                    <field name="start_date"/>
                    <field name="end_date"/>
                    <field name="state" widget="badge"/>
                    <field name="invoice_status" widget="badge"/>
                    <field name="pack_project_id_state" widget="badge"/>

                </tree>
            </field>
        </record>


    </data>
</odoo>